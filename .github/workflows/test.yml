name: test-qrhl-tool
on: [push]
env:
  ISA_VER: 2021-1-RC3
jobs:
    test:
      strategy:
        matrix:
          os: [linux, windows]
      runs-on: [self-hosted, "${{matrix.os}}"]
      steps:
        - name: Checkout repository
          uses: actions/checkout@v2
          with:
            submodules: true

        - name: Running tests (Linux)
          if: matrix.os == 'linux'
          run: |
            echo isabelle-home = /opt/Isabelle$ISA_VER >qrhl-tool.conf
            sbt 'testOnly -- -h target/test-reports-html'
            
        - name: Running tests (Windows)
          if: matrix.os == 'windows'
          run: |
            Set-Content -Path qrhl-tool.conf -Value 'isabelle-home = c:\Isabelle${{env.ISA_VER}}'
            c:\Isabelle${{env.ISA_VER}}\contrib\cygwin\bin\bash --login -c "/c/cygdrive/Isabelle${{env.ISA_VER}}/bin/isabelle build -b -o timeout_scale=4 Complex_Bounded_Operators"
            sbt 'testOnly -- -h target/test-reports-html'
            
        - name: Upload test results
          uses: actions/upload-artifact@v2
          if: always()
          with:
            name: test-reports-html
            path: target/test-reports-html
